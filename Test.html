<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ask Gemini AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --color-clifford: #da373d;
      }
    </style>
  <!-- Markdown Parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center font-sans px-4">

  <div class="w-full max-w-xl bg-white shadow-xl rounded-lg p-6 space-y-6">
    <h1 class="text-2xl font-bold text-purple-700 text-center">Ask Gemini AI</h1>

    <textarea 
      id="prompt"
      rows="4"
      class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
      placeholder="Ask a question like 'Summarize Ohm’s law'..."
    ></textarea>

    <button 
      onclick="askGemini()"
      class="w-full bg-purple-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-purple-700 transition"
    >
      ✨ Ask Gemini
    </button>

    <!-- Answer Container with Markdown + Typing -->
    <div id="answer" class="prose prose-sm max-w-none bg-gray-50 border border-gray-200 rounded-md p-4 text-gray-800 min-h-[100px]">
      <em class="text-gray-400">Your answer will appear here...</em>
    </div>
  </div>

  <script>
    async function askGemini() {
      const prompt = document.getElementById("prompt").value.trim();
      const answerBox = document.getElementById("answer");

      if (!prompt) {
        answerBox.innerHTML = "<em>Please enter a question.</em>";
        return;
      }

      answerBox.innerHTML = "<em class='text-gray-400'>Thinking...</em>";

      try {
        const response = await fetch("http://localhost:3000/ask-gemini", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ prompt })
        });

        const data = await response.json();
        const markdown = marked.parse(data.answer); // Convert Markdown → HTML
        typeWriter(answerBox, markdown);
      } catch (err) {
        answerBox.innerHTML = `<span class="text-red-600">Error: ${err.message}</span>`;
      }
    }

    function typeWriter(element, htmlText, speed = 15) {
      let i = 0;
      element.innerHTML = "";
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = htmlText;
      const plainText = tempDiv.innerText;

      const interval = setInterval(() => {
        if (i < plainText.length) {
          element.innerHTML = marked.parse(plainText.slice(0, i + 1));
          i++;
        } else {
          clearInterval(interval);
        }
      }, speed);
    }
  </script>

</body>
</html>